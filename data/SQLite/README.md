# Tennis Database (tennis.db)

This README provides an overview of the SQLite database `tennis.db`. Currently, the database contains two tables:
- `players_informations`: Stores information about tennis players.
- `atp_matches`: Contains detailed match statistics extracted from ATP match CSV files.

## Table `players_informations`

The `players_informations` table is designed to record the following details for each player:

| **Column Name** | **Data Type** | **Constraints**                           | **Description**                                                           |
|-----------------|---------------|-------------------------------------------|---------------------------------------------------------------------------|
| `player_id`     | INTEGER       | PRIMARY KEY, UNIQUE                       | A unique identifier for each player.                                      |
| `name_first`    | TEXT          | NOT NULL                                  | The player's first name.                                                  |
| `name_last`     | TEXT          | NOT NULL                                  | The player's last name.                                                   |
| `hand`          | TEXT          | NOT NULL, CHECK(hand IN ('L', 'R', 'U'))    | The dominant hand of the player: 'L' for left, 'R' for right, 'U' for unknown. |
| `dob`           | DATE          | -                                         | The player's date of birth, stored in the format `YYYY-MM-DD` (converted from `YYYYMMDD`). |
| `ioc`           | TEXT(3)       | NOT NULL                                  | The IOC (International Olympic Committee) country code representing the player's country. |
| `height`        | INTEGER       | Nullable                                  | The player's height in centimeters.                                       |

### Additional Details for `players_informations`

- **Date Conversion:**  
  The `dob` column is generated from a date string in the `YYYYMMDD` format found in the CSV file. A dedicated conversion function cleans and transforms this string into a date object.

- **Data Cleaning:**  
  The `hand` column is filtered to accept only the values 'L', 'R', or 'U'. If an invalid or missing value is encountered, the default value 'U' (unknown) is used.

- **Integrity Constraints:**  
  The `CHECK` constraint on the `hand` column ensures that only one of the specified values can be inserted.

## Table `atp_matches`

The `atp_matches` table stores detailed match statistics extracted and enriched from ATP match CSV files (named `atp_matches_YYYY.csv` for years 1991 to 2024). This table is generated by aggregating data from multiple sources and applying extensive feature engineering.

| **Column Name**            | **Data Type** | **Description**                                                                         |
|----------------------------|---------------|-----------------------------------------------------------------------------------------|
| `WINNER_ID`                | INTEGER       | Unique identifier of the match winner.                                                 |
| `LOSER_ID`                 | INTEGER       | Unique identifier of the match loser.                                                  |
| `ATP_POINT_DIFF`           | INTEGER       | Difference in ATP ranking points between the winner and the loser.                       |
| `ATP_RANK_DIFF`            | INTEGER       | Difference in ATP ranking positions between the winner and the loser.                    |
| `AGE_DIFF`                 | REAL          | Difference in age (in years) between the winner and the loser.                           |
| `HEIGHT_DIFF`              | INTEGER       | Difference in height (in centimeters) between the winner and the loser.                  |
| `BEST_OF`                  | INTEGER       | Indicates the match format (best-of series).                                             |
| `DRAW_SIZE`                | INTEGER       | The size of the tournament draw.                                                        |
| `H2H_DIFF`                 | INTEGER       | Cumulative head-to-head difference (overall) prior to each match.                        |
| `H2H_SURFACE_DIFF`         | INTEGER       | Head-to-head difference on the specific surface before each match.                       |
| `DIFF_N_GAMES`             | INTEGER       | Difference in the number of matches played by the winner vs. the loser before each match.  |
| `WIN_LAST_X_DIFF`          | REAL          | Difference in win rate over the last X matches (calculated for various window sizes: 3, 5, 10, 25, 50, 100). |
| `P_ACE_LAST_X_DIFF`        | REAL          | Difference in percentage of aces over the last X matches (for various window sizes).       |
| `P_DF_LAST_X_DIFF`         | REAL          | Difference in percentage of double faults over the last X matches (for various window sizes).|
| `P_1ST_IN_LAST_X_DIFF`     | REAL          | Difference in percentage of first serves in over the last X matches (for various window sizes).|
| `P_1ST_WON_LAST_X_DIFF`    | REAL          | Difference in percentage of first serve wins over the last X matches (for various window sizes).|
| `P_2ND_WON_LAST_X_DIFF`    | REAL          | Difference in percentage of second serve wins over the last X matches (for various window sizes).|
| `P_BP_SAVED_LAST_X_DIFF`   | REAL          | Difference in percentage of break points saved over the last X matches (for various window sizes).|
| `ELO_DIFF`                 | REAL          | Difference in overall ELO ratings between winner and loser after each match update.       |
| `WINNER_ELO`               | REAL          | The updated overall ELO rating for the winner after each match.                           |
| `LOSER_ELO`                | REAL          | The updated overall ELO rating for the loser after each match.                            |
| `ELO_SURFACE_DIFF`         | REAL          | Difference in surface-specific ELO ratings between winner and loser for the match's surface.|
| `WINNER_ELO_SURFACE`       | REAL          | The updated surface-specific ELO rating for the winner for the match's surface.           |
| `LOSER_ELO_SURFACE`        | REAL          | The updated surface-specific ELO rating for the loser for the match's surface.            |
| `ELO_GRAD_X_DIFF`          | REAL          | Difference in the ELO gradient (slope) over the last X matches (for various window sizes: 5, 10, 20, 35, 50, 100, 250). |

*Note:* Columns with suffix `_X` represent multiple columns corresponding to different window sizes used in the calculations.

### Additional Details for `atp_matches`

- **Data Integration:**  
  The table is generated by processing and concatenating CSV files from 1991 to 2024. It incorporates numerous performance metrics, head-to-head statistics, and ELO ratings (both overall and surface-specific).

- **Feature Engineering:**  
  Multiple features are derived, including win rate differences over recent matches, performance statistics differences (e.g., percentage of aces, double faults, etc.), and the evolution of ELO ratings.

- **ELO Calculations:**  
  The overall ELO ratings are updated using a standard formula (with a K-factor of 24) after each match. In addition, surface-specific ELO ratings are computed for each court type (e.g., Clay, Grass, Hard, Carpet).

## Usage

Two Python scripts are provided in the project:
1. A script to import and clean player data from a CSV file and populate the `players_informations` table.
2. A script to process ATP match data (from CSV files named `atp_matches_YYYY.csv`) and populate the `atp_matches` table with enriched match statistics.

Together, these tables enable comprehensive analysis of both player profiles and match-level performance data.

---

**Written by GenAI**
